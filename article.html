<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Loading Article | NGO Impact</title>
  <meta name="description" content="Article content"/>
  <script type="application/ld+json" id="json-ld"></script>
  <style>
    :root { --green: #2e7d32; --blue: #1976d2; --light: #f5f5f5; --dark: #333; }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: system-ui, sans-serif; line-height: 1.6; color: var(--dark); background: var(--light); }
    header { background: white; box-shadow: 0 2px 5px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 100; }
    nav { display: flex; justify-content: space-between; align-items: center; padding: 1rem; }
    .logo { font-weight: bold; color: var(--green); font-size: 1.4rem; text-decoration: none; }
    .nav-links { display: flex; gap: 1.5rem; list-style: none; }
    .nav-links a { text-decoration: none; color: var(--dark); }
    .hamburger { display: none; flex-direction: column; cursor: pointer; }
    .hamburger span { width: 25px; height: 3px; background: var(--dark); margin: 3px 0; }
    main { padding: 2rem 1rem; max-width: 800px; margin: 0 auto; background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
    .article-header { margin-bottom: 2rem; text-align: center; }
    .article-header h1 { font-size: 2rem; color: var(--green); margin-bottom: 0.5rem; }
    .meta { color: #666; font-size: 0.95rem; margin-bottom: 1.5rem; }
    .article-content { line-height: 1.8; }
    .article-content img { max-width: 100%; height: auto; border-radius: 8px; margin: 1.5rem 0; }
    .article-content h2 { margin: 1.8rem 0 1rem; color: var(--blue); }
    .article-content p { margin-bottom: 1.2rem; }
    footer { text-align: center; padding: 2rem 1rem; color: #666; border-top: 1px solid #eee; margin-top: 2rem; }
    @media (max-width: 768px) {
      .nav-links { display: none; position: absolute; top: 100%; left: 0; width: 100%; background: white; flex-direction: column; padding: 1rem; gap: 1rem; }
      .nav-links.active { display: flex; }
      .hamburger { display: flex; }
    }
  </style>
</head>
<body>
  <header>
    <nav aria-label="Main navigation">
      <a href="index.html" class="logo">NGO Impact</a>
      <ul class="nav-links" id="navLinks">
        <li><a href="index.html">Home</a></li>
        <li><a href="activities.html">Activities</a></li>
        <li><a href="team.html">Team</a></li>
        <li><a href="about.html">About</a></li>
        <li><a href="contact.html">Contact</a></li>
      </ul>
      <div class="hamburger" id="hamburger" tabindex="0" aria-label="Toggle navigation">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </nav>
  </header>

  <main>
    <div id="articleContent">
      <p>Loading article...</p>
    </div>
  </main>

  <footer>
    <p>&copy; 2025 NGO Impact</p>
  </footer>

  <script>
    const hamburger = document.getElementById('hamburger');
    const navLinks = document.getElementById('navLinks');
    hamburger.addEventListener('click', () => navLinks.classList.toggle('active'));
    hamburger.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        navLinks.classList.toggle('active');
      }
    });

    function markdownToHtml(md) {
      return md
        .replace(/^###### (.*$)/gm, '<h6>$1</h6>')
        .replace(/^##### (.*$)/gm, '<h5>$1</h5>')
        .replace(/^#### (.*$)/gm, '<h4>$1</h4>')
        .replace(/^### (.*$)/gm, '<h3>$1</h3>')
        .replace(/^## (.*$)/gm, '<h2>$1</h2>')
        .replace(/^# (.*$)/gm, '<h1>$1</h1>')
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
        .replace(/\*(.*?)\*/g, '<em>$1</em>')
        .replace(/!\[(.*?)\]\((.*?)\)/g, '<img src="$2" alt="$1" loading="lazy">')
        .replace(/\[(.*?)\]\((.*?)\)/g, '<a href="$2" target="_blank" rel="noopener">$1</a>')
        .replace(/^(-|\d+\.)\s+(.*$)/gm, '<li>$2</li>')
        .replace(/(?:^|\n)(-|\d+\.)(.*?)(?=\n(?:-|\d+\.)|\n\n|$)/gs, (match, p1, p2) => {
          const tag = p1 === '-' ? 'ul' : 'ol';
          return `<${tag}>${match.trim().split('\n').map(line => line.replace(/^(?:-|\d+\.)\s+/, '<li>') + '</li>').join('')}</${tag}>`;
        })
        .replace(/^(?!<[h|p|img|a|ul|ol|li]).*$/gm, '<p>$&</p>')
        .replace(/\n{2,}/g, '\n');
    }

    async function loadArticle() {
      const urlParams = new URLSearchParams(window.location.search);
      const id = urlParams.get('id');
      if (!id) {
        document.getElementById('articleContent').innerHTML = '<p>Article ID not specified.</p>';
        return;
      }

      try {
        const articlesRes = await fetch('data/articles.json');
        const articles = await articlesRes.json();
        const articleMeta = articles.find(a => a.id === id);
        if (!articleMeta) throw new Error('Article not found');

        const mdRes = await fetch(`content/articles/${id}.md`);
        if (!mdRes.ok) throw new Error('Failed to load article content');
        const md = await mdRes.text();
        const html = markdownToHtml(md);

        // Update title & meta
        document.title = `${articleMeta.title} | NGO Impact`;
        document.querySelector('meta[name="description"]').content = articleMeta.excerpt;

        // JSON-LD
        const jsonLd = {
          "@context": "https://schema.org",
          "@type": "NewsArticle",
          "headline": articleMeta.title,
          "datePublished": articleMeta.date,
          "image": articleMeta.image,
          "author": { "@type": "Organization", "name": "NGO Impact" },
          "publisher": { "@type": "Organization", "name": "NGO Impact", "logo": { "@type": "ImageObject", "url": "https://yourdomain.com/logo.png" } }
        };
        document.getElementById('json-ld').textContent = JSON.stringify(jsonLd);

        document.getElementById('articleContent').innerHTML = `
          <div class="article-header">
            <h1>${articleMeta.title}</h1>
            <div class="meta">${articleMeta.date} â€¢ ${articleMeta.category}</div>
          </div>
          <div class="article-content">${html}</div>
        `;
      } catch (err) {
        document.getElementById('articleContent').innerHTML = `<p>Error loading article: ${err.message}</p>`;
      }
    }

    document.addEventListener('DOMContentLoaded', loadArticle);
  </script>
</body>
</html>