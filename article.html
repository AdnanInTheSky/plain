<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Loading Article</title>
  <style>
    :root { --green: #2e7d32; --blue: #1976d2; --light: #f5f5f5; --dark: #333; }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: system-ui, sans-serif; line-height: 1.6; color: var(--dark); background: var(--light); }
    header { background: white; box-shadow: 0 2px 5px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 100; }
    nav { display: flex; justify-content: space-between; align-items: center; padding: 1rem; }
    .logo { font-weight: bold; color: var(--green); font-size: 1.4rem; text-decoration: none; }
    .nav-links { display: flex; gap: 1.5rem; list-style: none; }
    .hamburger { display: none; flex-direction: column; cursor: pointer; }
    .hamburger span { width: 25px; height: 3px; background: var(--dark); margin: 3px 0; }
    main { padding: 2rem 1rem; max-width: 800px; margin: 0 auto; }
    @media (max-width: 768px) {
      .nav-links { display: none; position: absolute; top: 100%; left: 0; width: 100%; background: white; flex-direction: column; padding: 1rem; gap: 1rem; }
      .nav-links.active { display: flex; }
      .hamburger { display: flex; }
    }
  </style>
</head>
<body>
  <header>
    <nav aria-label="Main navigation">
      <a href="index.html" class="logo">NGO Impact</a>
      <ul class="nav-links" id="navLinks">
        <li><a href="index.html">Home</a></li>
        <li><a href="activities.html">Activities</a></li>
        <li><a href="team.html">Team</a></li>
        <li><a href="about.html">About</a></li>
        <li><a href="contact.html">Contact</a></li>
      </ul>
      <div class="hamburger" id="hamburger" tabindex="0" aria-label="Toggle navigation">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </nav>
  </header>

  <main>
    <div id="content">Loading article...</div>
  </main>

  <script>
    document.getElementById('hamburger').addEventListener('click', () => {
      document.getElementById('navLinks').classList.toggle('active');
    });
    document.getElementById('hamburger').addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        document.getElementById('navLinks').classList.toggle('active');
      }
    });

    function markdownToHtml(md) {
      return md
        .replace(/^### (.*$)/gm, '<h3>$1</h3>')
        .replace(/^## (.*$)/gm, '<h2>$1</h2>')
        .replace(/^# (.*$)/gm, '<h1>$1</h1>')
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
        .replace(/!\[(.*?)\]\((.*?)\)/g, '<img src="$2" alt="$1" loading="lazy">')
        .replace(/\[(.*?)\]\((.*?)\)/g, '<a href="$2">$1</a>')
        .replace(/^(?!<[h|p|img|a]).*$/gm, '<p>$&</p>');
    }

    async function loadArticle() {
      const params = new URLSearchParams(window.location.search);
      const slug = params.get('slug');
      if (!slug) {
        document.getElementById('content').innerHTML = '<p>No slug provided.</p>';
        return;
      }

      try {
        const res = await fetch(`content/articles/${slug}.md`);
        const text = await res.text();

        // Split frontmatter and body
        const parts = text.split(/---\s*\n/);
        if (parts.length < 3) throw new Error('Invalid format');

        const yaml = parts[1];
        const body = parts.slice(2).join('---\n');

        // Parse frontmatter
        const meta = {};
        yaml.split('\n').forEach(line => {
          if (line.includes(':')) {
            const [key, ...value] = line.split(':');
            meta[key.trim()] = value.join(':').trim().replace(/^['"]|['"]$/g, '');
          }
        });

        document.title = meta.title || 'Article';
        document.getElementById('content').innerHTML = `
          <h1>${meta.title}</h1>
          <p><em>${meta.date} â€¢ ${meta.category}</em></p>
          <img src="${meta.image}" alt="${meta.title}" style="max-width:100%; margin:1rem 0;">
          <div>${markdownToHtml(body)}</div>
        `;
      } catch (err) {
        document.getElementById('content').innerHTML = `<p>Error: ${err.message}</p>`;
      }
    }

    document.addEventListener('DOMContentLoaded', loadArticle);
  </script>
</body>
</html>